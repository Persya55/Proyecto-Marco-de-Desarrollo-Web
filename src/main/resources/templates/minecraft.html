<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" th:href="@{/}" href="/">Pixel Play</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" th:href="@{/}" href="/">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/buscar_juegos}" href="/buscar_juegos">Juegos</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Administrar
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                            <li><a class="dropdown-item" th:href="@{/productos}" href="/productos">Productos</a></li>
                            <li><a class="dropdown-item" th:href="@{/usuarios}" href="/usuarios">Usuarios</a></li>
                            <li><a class="dropdown-item" th:href="@{/compras}" href="/compras">Compras</a></li>
                            <li><a class="dropdown-item" th:href="@{/graficos}" href="/graficos">Gráficos</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/carrito}" href="/carrito">Carrito</a></li>
                    <li class="nav-item"><a class="nav-link" th:href="@{#contacto}" href="#contacto">Contacto</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Iniciar Sesión</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row">
            <div class="col-md-6">
                <img src="https://http2.mlstatic.com/D_NQ_NP_684042-MLU72699956877_112023-O.webp" class="img-fluid" alt="Minecraft">
            </div>
            <div class="col-md-6">
                <h2>Minecraft</h2>
                <div>
                    <span class="badge bg-success">Aventura</span>
                    <span class="badge bg-primary">Playstation</span>
                </div>
                <p>Calificación: ⭐⭐⭐⭐⭐</p>
                <p>Precio: $29.99</p>
                <p>Envío: Gratis</p>
                <button class="btn btn-primary" id="buyButton">Comprar</button>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <h3>Reseñas</h3>
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Usuario 1</h5>
                <p class="card-text">"Un juego increíble, perfecto para todas las edades."</p>
                <p class="card-text">Calificación: ⭐⭐⭐⭐⭐</p>
            </div>
        </div>
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Usuario 2</h5>
                <p class="card-text">"Me encanta la libertad que ofrece para construir y explorar."</p>
                <p class="card-text">Calificación: ⭐⭐⭐⭐</p>
            </div>
        </div>
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Usuario 3</h5>
                <p class="card-text">"Ideal para jugar con amigos, aunque podría mejorar en gráficos."</p>
                <p class="card-text">Calificación: ⭐⭐⭐⭐</p>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <h3>Juegos que te podrían interesar</h3>
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <img src="https://smartcdkeys.com/image/cachewebp/data/products/monster-hunter-world-iceborne-deluxe-edition-dlc/cover/monster-hunter-world-iceborne-master-edition-smartcdkeys-cheap-cd-key-cover-390x580.webp" class="card-img-top" alt="Monster Hunter World: Iceborn Master Edition">
                    <div class="card-body">
                        <h5 class="card-title">Monster Hunter World: Iceborn Master Edition</h5>
                        <span class="badge bg-success">Aventura</span>
                        <span class="badge bg-dark">PC</span>
                        <p class="card-text">Precio: $40</p>
                        <a href="#" class="btn btn-primary">Ver más</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://m.media-amazon.com/images/I/810qImFqrkL._AC_UF894,1000_QL80_.jpg" class="card-img-top" alt="The Legend of Zelda: Breath Of the Wild (edicion coleccionista)">
                    <div class="card-body">
                        <h5 class="card-title">The Legend of Zelda: Breath Of the Wild (edicion coleccionista)</h5>
                        <span class="badge bg-success">Aventura</span>
                        <span class="badge bg-danger">Nintendo</span>
                        <p class="card-text">Precio: $59.99</p>
                        <a href="#" class="btn btn-primary">Ver más</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://m.media-amazon.com/images/I/81j+Pljm64L._SL1500_.jpg" class="card-img-top" alt="Monster Hunter Wilds: Steelbox edition">
                    <div class="card-body">
                        <h5 class="card-title">Monster Hunter Wilds: Steelbox edition</h5>
                        <span class="badge bg-success">Aventura</span>
                        <span class="badge bg-primary">PlayStation</span>
                        <p class="card-text">Precio: $59.99</p>
                        <a href="#" class="btn btn-primary">Ver más</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Iniciar Sesión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form onsubmit="handleLogin(event)">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">Usuario</label>
                            <input type="text" class="form-control" id="loginUsername" placeholder="Tu Usuario">
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="loginPassword" placeholder="Contraseña">
                        </div>
                        <button type="submit" class="btn btn-primary">Iniciar Sesión</button>
                    </form>
                    <div class="mt-3 text-center">
                        <p>¿No tienes una cuenta? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Regístrate aquí</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">Registrarse</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="registerUsername" class="form-label">Usuario</label>
                            <input type="text" class="form-control" id="registerUsername" placeholder="Usuario">
                        </div>
                        <div class="mb-3">
                            <label for="registerName" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="registerName" placeholder="Nombre Completo">
                        </div>
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="registerEmail" placeholder="nombre@ejemplo.com">
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="registerPassword" placeholder="Contraseña">
                        </div>
                        <button type="submit" class="btn btn-primary">Registrarse</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3">
        <p>Contáctanos por WhatsApp: <a href="https://wa.me/1234567890" class="text-white">123-456-7890</a></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    <script>
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (username && password) {
                fetch(`/api/usuarios/rol?usuario=${encodeURIComponent(username)}`)
                    .then(res => res.json())
                    .then(data => {
                        localStorage.setItem('loggedInUser', username);
                        localStorage.setItem('admin', data.admin ? 'true' : 'false');
                        alert(`Bienvenido, ${username}!`);
                        location.reload();
                    })
                    .catch(() => {
                        localStorage.setItem('loggedInUser', username);
                        localStorage.setItem('admin', 'false');
                        alert(`Bienvenido, ${username}!`);
                        location.reload();
                    });
            } else {
                alert('Por favor, completa todos los campos.');
            }
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loggedInUser = localStorage.getItem('loggedInUser');
            const navbar = document.querySelector('.navbar-nav');

            if (loggedInUser) {
                navbar.innerHTML = '';

                const homeLink = document.createElement('li');
                homeLink.classList.add('nav-item');
                homeLink.innerHTML = '<a class="nav-link" href="/">Inicio</a>';
                navbar.appendChild(homeLink);

                const juegosLink = document.createElement('li');
                juegosLink.classList.add('nav-item');
                juegosLink.innerHTML = '<a class="nav-link" href="/buscar_juegos">Juegos</a>';
                navbar.appendChild(juegosLink);

                const cartIcon = document.createElement('li');
                cartIcon.classList.add('nav-item');
                cartIcon.innerHTML = '<a class="nav-link" href="/carrito">Carrito</a>';
                navbar.appendChild(cartIcon);

                const userGreeting = document.createElement('li');
                userGreeting.classList.add('nav-item');
                userGreeting.innerHTML = `<span class="nav-link">Bienvenido, ${loggedInUser}</span>`;
                navbar.appendChild(userGreeting);

                const logoutButton = document.createElement('li');
                logoutButton.classList.add('nav-item');
                logoutButton.innerHTML = '<a class="nav-link" href="#" id="logoutButton">Cerrar Sesión</a>';
                navbar.appendChild(logoutButton);

                document.getElementById('logoutButton').addEventListener('click', () => {
                    localStorage.removeItem('loggedInUser');
                    alert('Has cerrado sesión.');
                    location.reload();
                });
            }
        });
    </script>
    <script>
        const loginModal = document.getElementById('loginModal');
        loginModal.addEventListener('show.bs.modal', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>
    <script>
        function addToCart(gameName, gamePrice) {
            const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
            cartItems.push({ name: gameName, price: gamePrice });
            localStorage.setItem('cart', JSON.stringify(cartItems));

            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success';
            alertDiv.textContent = 'El objeto se ha añadido al carrito satisfactoriamente';
            document.body.prepend(alertDiv);

            setTimeout(() => alertDiv.remove(), 3000);
        }

        document.getElementById('buyButton').addEventListener('click', (event) => {
            event.preventDefault();
            const loggedInUser = localStorage.getItem('loggedInUser');

            if (loggedInUser) {
                addToCart('Minecraft', 29.99);
            } else {
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
            }
        });
    </script>
    <script>
        const registerForm = document.querySelector('#registerModal form');
        if (registerForm) {
            registerForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const usuario = document.getElementById('registerUsername').value;
                const nombre = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                fetch('/registrarUsuario', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `usuario=${encodeURIComponent(usuario)}&nombre=${encodeURIComponent(nombre)}&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
                }).then(res => {
                    if (res.ok) {
                        alert('Usuario registrado correctamente.');
                        const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                        if (modal) modal.hide();
                    } else {
                        alert('Error al registrar usuario.');
                    }
                });
            });
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            const comprasMenu = document.querySelector('a[href="/compras"]')?.parentElement;
            if (comprasMenu) {
                comprasMenu.style.display = loggedInUser ? '' : 'none';
            }
        });
    </script>
</body>
<!--Observaciones de otros grupos-->
<!-- Se tiene que agrear una descripcion a la parte de los productos, no bastante larga, tambien hay que cambiar
     el tema del envio, no tiene sentido que sea algo por envio en algunos juegos deberia de tener una distincion 
     entre juego-->
</html>